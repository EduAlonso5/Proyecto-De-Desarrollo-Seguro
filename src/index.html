<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conexión con Base de Datos y JWT</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8));
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 500px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            padding: 35px;
            animation: fadeIn 0.8s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .logo {
            text-align: center;
            margin-bottom: 25px;
        }

        .logo i {
            font-size: 42px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo h1 {
            font-size: 28px;
            color: #333;
            margin-top: 10px;
            font-weight: 600;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 600;
            color: #777;
            transition: all 0.3s;
        }

        .tab.active {
            color: #764ba2;
            border-bottom: 3px solid #764ba2;
        }

        .form-container {
            display: none;
        }

        .form-container.active {
            display: block;
        }

        .input-group {
            position: relative;
            margin-bottom: 25px;
        }

        .input-group i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #764ba2;
            font-size: 18px;
        }

        .input-group input {
            width: 100%;
            padding: 15px 15px 15px 45px;
            border: 2px solid #f5f5f5;
            background: #f5f5f5;
            border-radius: 12px;
            outline: none;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            background: #eef2ff;
            border-color: #764ba2;
            box-shadow: 0 0 0 2px rgba(118, 75, 162, 0.3);
        }

        .char-count {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            color: #999;
            background: rgba(255, 255, 255, 0.8);
            padding: 2px 6px;
            border-radius: 10px;
        }

        .error-message {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.4);
        }

        .btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .api-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-top: 25px;
            font-size: 14px;
        }

        .api-info h3 {
            color: #764ba2;
            margin-bottom: 10px;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            overflow-x: auto;
            font-family: monospace;
            font-size: 13px;
        }

        .token-display {
            word-break: break-all;
            background: #2d2d2d;
            color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 12px;
            display: none;
        }

        .success-message {
            color: #2ecc71;
            font-size: 14px;
            margin-top: 15px;
            text-align: center;
            display: none;
        }

        .response-info {
            margin-top: 20px;
            padding: 15px;
            background: #e8f4fd;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            display: none;
        }

        .response-info h4 {
            color: #3498db;
            margin-bottom: 10px;
        }

        @media (max-width: 480px) {
            .container {
                padding: 25px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <i class="fas fa-database"></i>
            <h1>Conexión con Base de Datos</h1>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="login">Iniciar Sesión</div>
            <div class="tab" data-tab="register">Registrarse</div>
            <div class="tab" data-tab="config">Configuración</div>
        </div>

        <!-- Formulario de Login -->
        <div class="form-container active" id="login-form">
            <div class="input-group">
                <i class="fas fa-user"></i>
                <input type="text" id="login-username" placeholder="Usuario" required>
                <div class="error-message" id="login-username-error"></div>
            </div>

            <div class="input-group">
                <i class="fas fa-lock"></i>
                <input type="password" id="login-password" placeholder="Contraseña" required>
                <div class="error-message" id="login-password-error"></div>
            </div>

            <button class="btn" id="login-btn">
                <span id="login-text">INICIAR SESIÓN</span>
                <span id="login-loading" style="display: none;"><i class="fas fa-spinner fa-spin"></i> CONECTANDO...</span>
            </button>

            <div class="error-message" id="login-error" style="margin-top: 15px; text-align: center; display: none;"></div>
            <div class="success-message" id="login-success"></div>

            <div class="response-info" id="login-response">
                <h4>Respuesta del servidor:</h4>
                <pre id="login-response-data"></pre>
            </div>
        </div>

        <!-- Formulario de Registro -->
        <div class="form-container" id="register-form">
            <div class="input-group">
                <i class="fas fa-user"></i>
                <input type="text" id="reg-username" placeholder="Usuario" required>
                <div class="error-message" id="reg-username-error"></div>
            </div>

            <div class="input-group">
                <i class="fas fa-envelope"></i>
                <input type="email" id="reg-email" placeholder="Email" required>
                <div class="error-message" id="reg-email-error"></div>
            </div>

            <div class="input-group">
                <i class="fas fa-lock"></i>
                <input type="password" id="reg-password" placeholder="Contraseña" required>
                <div class="error-message" id="reg-password-error"></div>
            </div>

            <div class="input-group">
                <i class="fas fa-lock"></i>
                <input type="password" id="reg-confirm-password" placeholder="Confirmar Contraseña" required>
                <div class="error-message" id="reg-confirm-password-error"></div>
            </div>

            <button class="btn" id="register-btn">
                <span id="register-text">CREAR CUENTA</span>
                <span id="register-loading" style="display: none;"><i class="fas fa-spinner fa-spin"></i> REGISTRANDO...</span>
            </button>

            <div class="error-message" id="register-error" style="margin-top: 15px; text-align: center; display: none;"></div>
            <div class="success-message" id="register-success"></div>

            <div class="response-info" id="register-response">
                <h4>Respuesta del servidor:</h4>
                <pre id="register-response-data"></pre>
            </div>
        </div>

        <!-- Configuración de la API -->
        <div class="form-container" id="config-form">
            <div class="input-group">
                <i class="fas fa-server"></i>
                <input type="text" id="api-url" placeholder="URL de tu API (ej: http://localhost:4200/api)" value="http://localhost:4200/api">
            </div>

            <div class="input-group">
                <i class="fas fa-key"></i>
                <input type="text" id="jwt-secret" placeholder="Secreto JWT (para decodificar tokens)" value="mi_secreto_jwt">
            </div>

            <button class="btn" id="save-config">
                <span>GUARDAR CONFIGURACIÓN</span>
            </button>

            <div class="success-message" id="config-success"></div>

            
        </div>

        <!-- Información de JWT -->
        <div class="api-info">
            <h3>Información de Autenticación JWT</h3>
            <div id="jwt-info">
                <p>No hay token JWT almacenado. Inicia sesión para obtener uno.</p>
            </div>
            <div id="jwt-token" class="token-display"></div>
            <button class="btn" id="decode-jwt" style="margin-top: 10px; display: none;">DECODIFICAR JWT</button>
            <div id="jwt-payload" class="token-display" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Elementos del DOM
        const tabs = document.querySelectorAll('.tab');
        const formContainers = document.querySelectorAll('.form-container');
        
        // Configuración
        let API_URL = 'http://localhost:8080/api';
        let JWT_SECRET = 'mi_secreto_jwt';
        
        // Cambio de pestañas
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                tabs.forEach(t => t.classList.remove('active'));
                formContainers.forEach(f => f.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(`${tabId}-form`).classList.add('active');
            });
        });
        
        // Guardar configuración
        document.getElementById('save-config').addEventListener('click', function() {
            API_URL = document.getElementById('api-url').value;
            JWT_SECRET = document.getElementById('jwt-secret').value;
            
            showSuccess('config-success', 'Configuración guardada correctamente');
        });
        
        // Función para mostrar errores
        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }
        
        // Función para ocultar errores
        function hideError(elementId) {
            const errorElement = document.getElementById(elementId);
            errorElement.style.display = 'none';
        }
        
        // Función para mostrar éxito
        function showSuccess(elementId, message) {
            const successElement = document.getElementById(elementId);
            successElement.textContent = message;
            successElement.style.display = 'block';
            
            setTimeout(() => {
                successElement.style.display = 'none';
            }, 3000);
        }
        
        // Función para mostrar loading
        function setLoading(button, isLoading) {
            const text = button.querySelector(':scope > span:first-child');
            const loading = button.querySelector(':scope > span:last-child');
            
            if (isLoading) {
                text.style.display = 'none';
                loading.style.display = 'inline';
                button.disabled = true;
            } else {
                text.style.display = 'inline';
                loading.style.display = 'none';
                button.disabled = false;
            }
        }
        
        // Función para mostrar respuesta del servidor
        function showResponse(containerId, data) {
            const container = document.getElementById(containerId);
            const pre = container.querySelector('pre');
            pre.textContent = JSON.stringify(data, null, 2);
            container.style.display = 'block';
        }
        
        // Función para realizar peticiones HTTP
        async function makeRequest(url, method, data) {
            try {
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                return await response.json();
            } catch (error) {
                console.error('Error en la petición:', error);
                throw new Error('Error de conexión con el servidor');
            }
        }
        
        // Registro de usuario
        document.getElementById('register-btn').addEventListener('click', async function() {
            const username = document.getElementById('reg-username').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirm-password').value;
            
            // Ocultar errores previos
            hideError('reg-username-error');
            hideError('reg-email-error');
            hideError('reg-password-error');
            hideError('reg-confirm-password-error');
            hideError('register-error');
            document.getElementById('register-response').style.display = 'none';
            
            // Validaciones básicas
            if (!username) {
                showError('reg-username-error', 'El usuario es requerido');
                return;
            }
            
            if (!email) {
                showError('reg-email-error', 'El email es requerido');
                return;
            } else if (!/\S+@\S+\.\S+/.test(email)) {
                showError('reg-email-error', 'Formato de email inválido');
                return;
            }
            
            if (!password) {
                showError('reg-password-error', 'La contraseña es requerida');
                return;
            }
            
            if (password !== confirmPassword) {
                showError('reg-confirm-password-error', 'Las contraseñas no coinciden');
                return;
            }
            
            setLoading(this, true);
            
            try {
                // Realizar petición al servidor
                const response = await makeRequest(`${API_URL}/auth/register`, 'POST', {
                    username,
                    email,
                    password
                });
                
                // Mostrar respuesta
                showResponse('register-response', response);
                
                if (response.success) {
                    showSuccess('register-success', '¡Usuario registrado correctamente!');
                    // Limpiar formulario
                    document.getElementById('register-form').reset();
                    // Cambiar a pestaña de login
                    tabs[0].click();
                } else {
                    showError('register-error', response.message || 'Error en el registro');
                }
            } catch (error) {
                showError('register-error', error.message);
            } finally {
                setLoading(this, false);
            }
        });
        
        // Login de usuario
        document.getElementById('login-btn').addEventListener('click', async function() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            // Ocultar errores previos
            hideError('login-username-error');
            hideError('login-password-error');
            hideError('login-error');
            document.getElementById('login-response').style.display = 'none';
            
            // Validaciones básicas
            if (!username) {
                showError('login-username-error', 'El usuario es requerido');
                return;
            }
            
            if (!password) {
                showError('login-password-error', 'La contraseña es requerida');
                return;
            }
            
            setLoading(this, true);
            
            try {
                // Realizar petición al servidor
                const response = await makeRequest(`${API_URL}/auth/login`, 'POST', {
                    username,
                    password
                });
                
                // Mostrar respuesta
                showResponse('login-response', response);
                
                if (response.success) {
                    showSuccess('login-success', '¡Login exitoso!');
                    // Guardar token JWT
                    localStorage.setItem('jwtToken', response.token);
                    updateJWTInfo(response.token);
                } else {
                    showError('login-error', response.message || 'Error en el login');
                }
            } catch (error) {
                showError('login-error', error.message);
            } finally {
                setLoading(this, false);
            }
        });
        
        // Actualizar información del JWT
        function updateJWTInfo(token) {
            const jwtInfo = document.getElementById('jwt-info');
            const jwtTokenElement = document.getElementById('jwt-token');
            const decodeBtn = document.getElementById('decode-jwt');
            
            if (token) {
                jwtInfo.innerHTML = `
                    <p>Token JWT almacenado correctamente.</p>
                    <p><strong>Longitud:</strong> ${token.length} caracteres</p>
                `;
                jwtTokenElement.textContent = token;
                jwtTokenElement.style.display = 'block';
                decodeBtn.style.display = 'block';
            } else {
                jwtInfo.innerHTML = '<p>No hay token JWT almacenado. Inicia sesión para obtener uno.</p>';
                jwtTokenElement.style.display = 'none';
                decodeBtn.style.display = 'none';
            }
        }
        
        // Decodificar JWT (solo la parte del payload)
        document.getElementById('decode-jwt').addEventListener('click', function() {
            const token = localStorage.getItem('jwtToken');
            if (!token) return;
            
            try {
                // El token JWT tiene 3 partes separadas por puntos
                const payloadBase64 = token.split('.')[1];
                // Base64 decode y parse JSON
                const payload = JSON.parse(atob(payloadBase64));
                
                document.getElementById('jwt-payload').textContent = JSON.stringify(payload, null, 2);
                document.getElementById('jwt-payload').style.display = 'block';
            } catch (error) {
                console.error('Error decodificando JWT:', error);
            }
        });
        
        // Al cargar la página, verificar si hay un token almacenado
        window.addEventListener('load', () => {
            const token = localStorage.getItem('jwtToken');
            updateJWTInfo(token);
            
            // Cargar configuración guardada
            const savedApiUrl = localStorage.getItem('apiUrl');
            const savedJwtSecret = localStorage.getItem('jwtSecret');
            
            if (savedApiUrl) {
                document.getElementById('api-url').value = savedApiUrl;
                API_URL = savedApiUrl;
            }
            
            if (savedJwtSecret) {
                document.getElementById('jwt-secret').value = savedJwtSecret;
                JWT_SECRET = savedJwtSecret;
            }
        });
    </script>
</body>
</html>